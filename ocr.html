<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>OCR</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
</head>

<body>
    <input id="file" type="file" accept="image/*">
    <button id="space">trim</button>
    <textarea></textarea>
    <img />
    <dialog>
        <div id="status"></div>
        <progress value="0" max="1"></progress>
    </dialog>
    <script>
        const dialog = document.querySelector('dialog');
        const textarea = document.querySelector('textarea');
        document.querySelector('#file').addEventListener('change', e => {
            const file = e.target.files[0];
            new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = resolve;
                reader.onerror = reject;
                reader.readAsDataURL(file);
            }).then(e => {
                const img = document.querySelector('img');
                img.src = e.target.result;
                img.width = innerWidth / 2;
                dialog.showModal();
                return Tesseract.recognize(img, ['eng', 'jpn'], {
                    logger: m => {
                        document.querySelector('#status').textContent = m.status;
                        document.querySelector('progress').value = m.progress;
                    },
                    errorHandler: alert
                });
            }).then(result => {
                textarea.value = result.data.text;
                dialog.close();
            }).catch(alert);
        });
        document.querySelector('#space').addEventListener('click', () => textarea.value = textarea.value.trim().replaceAll(' ', ''));
        textarea.style.width = `${innerWidth}px`;
        textarea.style.height = `${innerHeight / 2}px`;
        textarea.addEventListener('focus', () => textarea.select());
    </script>
</body>

</html>